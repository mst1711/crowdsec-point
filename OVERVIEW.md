# üõ°Ô∏è Nginx + CrowdSec Security Monitoring System

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞, —Å–æ—Å—Ç–æ—è—â–∞—è –∏–∑ Nginx –∏ CrowdSec, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –¥–ª—è **–∞–ª–µ—Ä—Ç–∏–Ω–≥–∞ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** —Ç—Ä–∞—Ñ–∏–∫–∞. –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç DDoS –∞—Ç–∞–∫–∏, –±–æ—Ç–æ–≤, –±—Ä—É—Ç—Ñ–æ—Ä—Å –∏ –¥—Ä—É–≥–∏–µ —É–≥—Ä–æ–∑—ã, –æ—Ç–ø—Ä–∞–≤–ª—è—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Slack/Email.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **Nginx –≤–µ–±-—Å–µ—Ä–≤–µ—Ä** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ **CrowdSec –∞–Ω–∞–ª–∏–∑** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏  
- ‚úÖ **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞—Ç–∞–∫**: DDoS, –±–æ—Ç—ã, –±—Ä—É—Ç—Ñ–æ—Ä—Å, —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: Slack, Email, –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ **–†–µ–∂–∏–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**: —Ç–æ–ª—å–∫–æ –∞–ª–µ—Ä—Ç—ã, –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- ‚úÖ **–ì–æ—Ç–æ–≤—ã–µ —Ç–µ—Å—Ç—ã** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** Metabase –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
docker-compose up -d

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
curl http://localhost:54104

# 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
./test-security.sh

# 4. –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–ª–µ—Ä—Ç–æ–≤
docker-compose exec crowdsec cscli alerts list
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
nginx-crowdsec-security/
‚îú‚îÄ‚îÄ üìÑ docker-compose.yml          # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üìÑ docker-compose.prod.yml     # –ü—Ä–æ–¥–∞–∫—à–µ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üìÑ .env.example                # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ üìÑ Makefile                    # –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ üìÑ test-security.sh            # –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îÇ
‚îú‚îÄ‚îÄ üìÇ nginx/                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf                 # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ default.conf               # –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç
‚îÇ
‚îú‚îÄ‚îÄ üìÇ crowdsec/                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CrowdSec
‚îÇ   ‚îú‚îÄ‚îÄ acquis.yaml                # –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ config.yaml                # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ profiles.yaml              # –ü—Ä–æ—Ñ–∏–ª–∏ –∞–ª–µ—Ä—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ simulation.yaml            # –†–µ–∂–∏–º —Å–∏–º—É–ª—è—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ notifications/             # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ slack.yaml
‚îÇ       ‚îî‚îÄ‚îÄ email.yaml
‚îÇ
‚îú‚îÄ‚îÄ üìÇ html/                       # –í–µ–±-–∫–æ–Ω—Ç–µ–Ω—Ç
‚îî‚îÄ‚îÄ üìÇ logs/                       # –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
```

## üîß –°–µ—Ä–≤–∏—Å—ã –∏ –ø–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| **Nginx** | 54104, 57885 | –í–µ–±-—Å–µ—Ä–≤–µ—Ä |
| **Metabase** | 3000 | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ |
| **CrowdSec API** | 8080 | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π API |

## üõ°Ô∏è –¢–∏–ø—ã –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ–º—ã—Ö –∞—Ç–∞–∫

### ü§ñ –ë–æ—Ç—ã –∏ —Å–∫–∞–Ω–µ—Ä—ã
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ User-Agent (sqlmap, nikto, etc.)
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∫—Ä—ã—Ç—ã–º —Ñ–∞–π–ª–∞–º

### üåä DDoS –∞—Ç–∞–∫–∏  
- –ê–Ω–æ–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP
- HTTP —Ñ–ª—É–¥ –∞—Ç–∞–∫–∏
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

### üîì –ë—Ä—É—Ç—Ñ–æ—Ä—Å –∞—Ç–∞–∫–∏
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- –ü–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—è–º

### üïµÔ∏è –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- –ü–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º
- –ü–æ–∏—Å–∫ –±—ç–∫–∞–ø–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **Slack** - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª
- **Email** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –Ω–∞ –ø–æ—á—Ç—É
- **Metabase** - –≤–µ–±-–¥–∞—à–±–æ—Ä–¥ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏

### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –∞—Ç–∞–∫
- –¢–æ–ø –∞—Ç–∞–∫—É—é—â–∏—Ö IP-–∞–¥—Ä–µ—Å–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –∞—Ç–∞–∫
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `QUICKSTART.md` | –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç |
| `README.md` | –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |
| `DEPLOYMENT.md` | –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é |
| `PROJECT_STRUCTURE.md` | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ |

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Makefile
make start          # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make stop           # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
make restart        # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
make logs           # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make status         # –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
make test           # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

# CrowdSec –∫–æ–º–∞–Ω–¥—ã
docker-compose exec crowdsec cscli alerts list    # –ê–ª–µ—Ä—Ç—ã
docker-compose exec crowdsec cscli metrics        # –ú–µ—Ç—Ä–∏–∫–∏
docker-compose exec crowdsec cscli decisions list # –†–µ—à–µ–Ω–∏—è
```

## üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### Slack
```yaml
# crowdsec/notifications/slack.yaml
url: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
```

### Email
```yaml
# crowdsec/notifications/email.yaml
smtp_host: smtp.gmail.com
smtp_username: "your-email@gmail.com"
recipients:
  - "admin@yourdomain.com"
```

## üöÄ –ü—Ä–æ–¥–∞–∫—à–µ–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose -f docker-compose.prod.yml up -d
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–†–µ–∂–∏–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**: CrowdSec —Ç–æ–ª—å–∫–æ –∞–ª–µ—Ä—Ç–∏—Ç, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
- **–ó–∞—â–∏—Ç–∞ Nginx**: —Ç–∞–π–º–∞—É—Ç—ã, –ª–∏–º–∏—Ç—ã, —Å–∫—Ä—ã—Ç–∏–µ –≤–µ—Ä—Å–∏–∏
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∞—Ç–∞–∫

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–õ–æ–≥–∏**: `docker-compose logs`
- **–°—Ç–∞—Ç—É—Å**: `docker-compose ps`
- **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫**: `docker-compose restart`
- **–û—á–∏—Å—Ç–∫–∞**: `docker-compose down -v`

---

**üéâ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** –°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏.